/* File generated by kazoo for TASTE - do not edit */
#include "demo_polyorb_interface.h"

// Required interfaces of function Function_1

// Required interface PI_1 in function Function_1
void vm_function_1_pi_1
        (const char *IN_buf_p1, size_t size_IN_buf_p1)

{
   __po_hi_task_id current_task = __po_hi_get_task_id();
   // function_1_PI_2 calling thread
   if (demo_function_1_pi_2_k == current_task) {
      // puts("[TASTE] Sporadic call of PI_1 from thread demo_function_1_pi_2");
      __po_hi_request_t *request = __po_hi_get_request (function_1_pi_2_global_outport_function_2_pi_1); 
      __po_hi_copy_array(&(request->vars.function_1_pi_2_global_outport_function_2_pi_1.function_1_pi_2_global_outport_function_2_pi_1.buffer), 
      (void *)IN_buf_p1, size_IN_buf_p1); 
      request->vars.function_1_pi_2_global_outport_function_2_pi_1.function_1_pi_2_global_outport_function_2_pi_1.length = 
      size_IN_buf_p1; 
      request->port = function_1_pi_2_global_outport_function_2_pi_1; 
      __po_hi_gqueue_store_out(demo_function_1_pi_2_k, function_1_pi_2_local_outport_function_2_pi_1, request); 
      __po_hi_send_output(demo_function_1_pi_2_k, function_1_pi_2_global_outport_function_2_pi_1);

      return;
   }
   // function_1_Poll calling thread
   if (demo_function_1_poll_k == current_task) {
      // puts("[TASTE] Sporadic call of PI_1 from thread demo_function_1_poll");
      __po_hi_request_t *request = __po_hi_get_request (function_1_poll_global_outport_function_2_pi_1); 
      __po_hi_copy_array(&(request->vars.function_1_poll_global_outport_function_2_pi_1.function_1_poll_global_outport_function_2_pi_1.buffer), 
      (void *)IN_buf_p1, size_IN_buf_p1); 
      request->vars.function_1_poll_global_outport_function_2_pi_1.function_1_poll_global_outport_function_2_pi_1.length = 
      size_IN_buf_p1; 
      request->port = function_1_poll_global_outport_function_2_pi_1; 
      __po_hi_gqueue_store_out(demo_function_1_poll_k, function_1_poll_local_outport_function_2_pi_1, request); 
      __po_hi_send_output(demo_function_1_poll_k, function_1_poll_global_outport_function_2_pi_1);

      return;
   }
   // calling threads: function_1_PI_2, function_1_Poll partition: demo
}

// Required interfaces of function Function_2

// Required interface PI_2 in function Function_2
void vm_function_2_pi_2
        (const char *IN_buf_p1, size_t size_IN_buf_p1)

{
   __po_hi_task_id current_task = __po_hi_get_task_id();
   // function_2_PI_1 calling thread
   if (demo_function_2_pi_1_k == current_task) {
      // puts("[TASTE] Sporadic call of PI_2 from thread demo_function_2_pi_1");
      __po_hi_request_t *request = __po_hi_get_request (function_2_pi_1_global_outport_function_1_pi_2); 
      __po_hi_copy_array(&(request->vars.function_2_pi_1_global_outport_function_1_pi_2.function_2_pi_1_global_outport_function_1_pi_2.buffer), 
      (void *)IN_buf_p1, size_IN_buf_p1); 
      request->vars.function_2_pi_1_global_outport_function_1_pi_2.function_2_pi_1_global_outport_function_1_pi_2.length = 
      size_IN_buf_p1; 
      request->port = function_2_pi_1_global_outport_function_1_pi_2; 
      __po_hi_gqueue_store_out(demo_function_2_pi_1_k, function_2_pi_1_local_outport_function_1_pi_2, request); 
      __po_hi_send_output(demo_function_2_pi_1_k, function_2_pi_1_global_outport_function_1_pi_2);

      return;
   }
   // calling threads: function_2_PI_1 partition: demo
}

void function_2_check_queue(bool *OUT_has_pending_msg)
{
   // Check all incoming queues for a pending message
   *OUT_has_pending_msg = false;
   if(__po_hi_gqueue_get_count(
        demo_function_2_pi_1_k,
        function_2_pi_1_local_inport_pi_1)) {
      *OUT_has_pending_msg = true;
      return;
   }
}

#include "function_1_vm_if.h"

// Function called by the middleware when task is ready to run
void call_function_1_pi_2 (__po_hi_task_id sender_pid, dataview__mychoice_buffer_impl *buf)
{
   (void)sender_pid; // sender id is not used for now

    extern process_package__taste_protected_object function_1_protected;
   __po_hi_protected_lock (function_1_protected.protected_id);
   function_1_PI_2 (buf->buffer, buf->length);
   __po_hi_protected_unlock (function_1_protected.protected_id);
}
#include "function_1_vm_if.h"

// Function called by the middleware when task is ready to run
void call_function_1_poll (__po_hi_task_id sender_pid)
{
   (void)sender_pid; // sender id is not used for now

    extern process_package__taste_protected_object function_1_protected;
   __po_hi_protected_lock (function_1_protected.protected_id);
   function_1_Poll();
   __po_hi_protected_unlock (function_1_protected.protected_id);
}
#include "function_2_vm_if.h"

// Function called by the middleware when task is ready to run
void call_function_2_pi_1 (__po_hi_task_id sender_pid, dataview__myseqof_buffer_impl *buf)
{
   (void)sender_pid; // sender id is not used for now

   function_2_PI_1 (buf->buffer, buf->length);
}
